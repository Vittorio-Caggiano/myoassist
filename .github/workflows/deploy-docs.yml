name: Deploy Documentation

on:
  push:
    branches: [ myoassist0.1prepare ]
  pull_request:
    branches: [ myoassist0.1prepare ]

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        ref: myoassist0.1prepare
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install sphinx==5.3.0 sphinx-rtd-theme==1.3.0 myst-parser==0.18.1 docutils==0.18.1
    
    - name: Setup Sphinx documentation
      run: |
        # Create Sphinx documentation directory
        mkdir -p build/sphinx-docs/_static build/sphinx-docs/_templates build/sphinx-docs/source
        
        # Copy Sphinx configuration and source files from gh-pages branch
        git fetch origin gh-pages
        git checkout origin/gh-pages -- conf.py Makefile *.rst || echo "Some files not found"
        
        # Move RST files and config to correct directories
        if ls *.rst 1> /dev/null 2>&1; then
          mv *.rst build/sphinx-docs/source/
        else
          echo "No RST files found"
        fi
        mv conf.py Makefile build/sphinx-docs/ || echo "Config files not found"
        
        # Copy markdown files directly into source directory
        if [ -d "docs" ]; then
          echo "Copying documentation files..."
          cp docs/*.md build/sphinx-docs/source/
          # Copy assets and images if they exist
          if [ -d "docs/assets" ]; then
            cp -r docs/assets build/sphinx-docs/_static/
          fi
          if [ -d "docs/images" ]; then
            cp -r docs/images build/sphinx-docs/_static/
          fi
        fi
        
                 echo "Build directory structure:"
         ls -la build/
         echo "Sphinx files:"
         ls -la build/sphinx-docs/
         echo "Source files:"
         ls -la build/sphinx-docs/source/
    
    - name: Build Sphinx documentation
      run: |
        cd build/sphinx-docs
        
        # Build the documentation
        make html
        
        # Copy built documentation to docs-site
        mkdir -p ../../docs-site
        cp -r _build/html/* ../../docs-site/
        
        echo "Sphinx documentation built successfully"
        ls -la ../../docs-site/
    
    - name: Setup Pages
      uses: actions/configure-pages@v4
    
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: ./docs-site
    
    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4 